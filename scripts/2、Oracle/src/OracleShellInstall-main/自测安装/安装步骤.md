# 环境准备

## 单节点安装

~~~shell
#语言环境设置
echo 'export LANG=en_US.UTF-8' >> /etc/profile
source /etc/profile

#改主机名：
hostnamectl set-hostname testos
#改hosts文件配置
cat >> /etc/hosts << EOF
192.168.1.40 testos
EOF
#修改IP配置文件信息 
sed -i '/IPADDR/s/192.168.1.100/192.168.1.40/' /etc/sysconfig/network-scripts/ifcfg-ens33
#修改IP信息，同时删除对应的UUID
sed -i '/^UUID/d' /etc/sysconfig/network-scripts/ifcfg-ens33
#重启网络服务
systemctl restart network


#linux 7 yum配置
mount /dev/cdrom /mnt
cd /etc/yum.repos.d
mkdir bk
mv *.repo bk/

cat >test.repo<<EOF
[EL7]
name = linux 7.6 dvd
baseurl=file:///mnt
gpgcheck=0
enabled=1
EOF

#安装常见工具
yum install -y tree
yum install -y net-tools
yum install -y vim
yum install -y python3
yum install -y expect
yum install -y lsof
yum install -y wget
yum install -y mlocate
yum install -y lvm2
yum install -y lrzsz
yum install -y telnet-server telnet
yum install -y unix2dos
yum install -y dos2unix

#安装图像界面
yum groupinstall -y "Server with GUI"


#rlwrap
wget https://gitcode.net/myneth/tools/-/raw/master/tool/rlwrap_0.42.tar.gz
tar -zxvf rlwrap_0.42.tar.gz
rpm -ivh ncurses-devel-5.9-14.20130511.el7_4.x86_64.rpm
rpm -ivh readline-devel-6.2-10.el7.x86_64.rpm
tar -zxvf rlwrap-0.42.tar.gz
cd rlwrap-0.42
./configure
make
make install


#准备文件系统
pvcreate /dev/sdb
vgcreate oravg /dev/sdb
lvcreate -n oralv -L 190G oravg
mkfs.ext4 /dev/oravg/oralv
echo "/dev/oravg/oralv  /oracle  ext4  defaults  0 0">>/etc/fstab
mkdir /oracle
mount -a
df -h
~~~

## RAC多节点

配置双网卡

```shell
[root@testos1:/root]# cd /etc/sysconfig/network-scripts/
[root@testos1 network-scripts]# cp ifcfg-ens33 ifcfg-ens35
#修改一下几个选项
[root@testos1 network-scripts]# egrep "^NAME|^DEVICE|^IPADDR|^GATEWAY" ifcfg-ens35
NAME="ens35"
DEVICE="ens35"
IPADDR="1.1.1.3"
GATEWAY="1.1.1.1"
#重启网络服务
[root@testos1 network-scripts]# systemctl restart network
```



# 单机安装步骤

## 11g

### 上传软件安装包和一键安装脚本

~~~shell
#创建软件存放目录
[root@testos ~]# mkdir -p /soft
[root@testos ~]# cd /soft
[root@testos soft]# chmod +x OracleShellInstall
[root@testos soft]# ll
total 2487368
-rwxr-xr-x. 1 root root     161014 Jul 26 11:02 OracleShellInstall
-rw-r--r--. 1 root root 1395582860 Jul 30  2020 p13390677_112040_Linux-x86-64_1of7.zip
-rw-r--r--. 1 root root 1151304589 Jul 30  2020 p13390677_112040_Linux-x86-64_2of7.zip
[root@testos soft]# 
[root@testos soft]# cd
#确定要挂载光盘镜像，安装过程过程中会安装依赖：  mount /dev/cdrom /mnt
[root@testos ~]# df -h /mnt
Filesystem      Size  Used Avail Use% Mounted on
/dev/sr0        4.3G  4.3G     0 100% /mnt
~~~

### 执行一键安装命令

~~~shell
./OracleShellInstall -lf ens33 `# local ip ifname`\
-n testos `# hostname`\
-op oracle `# oracle password`\
-d /oracle `# software base dir`\
-ord /oracle/oradata `# data dir`\
-o testdb `# dbname`\
-dp oracle `# sys/system password`\
-ds AL32UTF8 `# database character`\
-ns UTF8 `# national character`\
-redo 200 `# redo size`\
-opd Y `# optimize db`
~~~

### 安装完整过程

~~~shell
[root@testos software]# ./OracleShellInstall -lf ens33 `# local ip ifname`\
> -n testos `# hostname`\
> -op oracle `# oracle password`\
> -d /oracle `# software base dir`\
> -ord /oracle/oradata `# data dir`\
> -o testdb `# dbname`\
> -dp oracle `# sys/system password`\
> -ds AL32UTF8 `# database character`\
> -ns UTF8 `# national character`\
> -redo 200 `# redo size`\
> -opd Y `# optimize db`

   ███████                             ██          ████████ ██               ██  ██ ██                    ██              ██  ██
  ██░░░░░██                           ░██         ██░░░░░░ ░██              ░██ ░██░██                   ░██             ░██ ░██
 ██     ░░██ ██████  ██████    █████  ░██  █████ ░██       ░██       █████  ░██ ░██░██ ███████   ██████ ██████  ██████   ░██ ░██
░██      ░██░░██░░█ ░░░░░░██  ██░░░██ ░██ ██░░░██░█████████░██████  ██░░░██ ░██ ░██░██░░██░░░██ ██░░░░ ░░░██░  ░░░░░░██  ░██ ░██
░██      ░██ ░██ ░   ███████ ░██  ░░  ░██░███████░░░░░░░░██░██░░░██░███████ ░██ ░██░██ ░██  ░██░░█████   ░██    ███████  ░██ ░██
░░██     ██  ░██    ██░░░░██ ░██   ██ ░██░██░░░░        ░██░██  ░██░██░░░░  ░██ ░██░██ ░██  ░██ ░░░░░██  ░██   ██░░░░██  ░██ ░██
 ░░███████  ░███   ░░████████░░█████  ███░░██████ ████████ ░██  ░██░░██████ ███ ███░██ ███  ░██ ██████   ░░██ ░░████████ ███ ███
  ░░░░░░░   ░░░     ░░░░░░░░  ░░░░░  ░░░  ░░░░░░ ░░░░░░░░  ░░   ░░  ░░░░░░ ░░░ ░░░ ░░ ░░░   ░░ ░░░░░░     ░░   ░░░░░░░░ ░░░ ░░░ 


请选择安装模式 [单机(si)/单机ASM(sa)/集群(rac)] : si

数据库安装模式: single                                                                           

请选择数据库版本 [11/12/19/21] : 11

数据库版本:     11                                                                               

#==============================================================#                                                                                  
配置本地 YUM 源                                                                                  
#==============================================================#                                                                                  

[server]
name=server
baseurl=file:///mnt
enabled=1
gpgcheck=0

#==============================================================#                                                                                  
配置 SWAP 交换空间                                                                                  
#==============================================================#                                                                                  

0+0 records in
0+0 records out
0 bytes (0 B) copied, 0.000255294 s, 0.0 kB/s
mkswap: error: swap area needs to be at least 40 KiB

Usage:
 mkswap [options] device [size]

Options:
 -c, --check               check bad blocks before creating the swap area
 -f, --force               allow swap size area be larger than device
 -p, --pagesize SIZE       specify page size in bytes
 -L, --label LABEL         specify label
 -v, --swapversion NUM     specify swap-space version number
 -U, --uuid UUID           specify the uuid to use
 -V, --version             output version information and exit
 -h, --help                display this help and exit

swapon: /swapfile: read swap header failed: Invalid argument
              total        used        free      shared  buff/cache   available
Mem:           7803         195        4731          11        2875        7276
Swap:          7628           0        7628

#==============================================================#                                                                                  
禁用防火墙                                                                                       
#==============================================================#                                                                                  

● firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)
   Active: inactive (dead)
     Docs: man:firewalld(1)

Jan 14 13:30:23 centos7.6 systemd[1]: Starting firewalld - dynamic firewall daemon...
Jan 14 13:30:24 centos7.6 systemd[1]: Started firewalld - dynamic firewall daemon.
Jan 14 13:37:05 testos systemd[1]: Stopping firewalld - dynamic firewall daemon...
Jan 14 13:37:07 testos systemd[1]: Stopped firewalld - dynamic firewall daemon.

#==============================================================#                                                                                  
禁用 SELinux                                                                                        
#==============================================================#                                                                                  

SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   permissive
Mode from config file:          disabled
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Max kernel policy version:      31

#==============================================================#                                                                                  
YUM 静默安装依赖包                                                                                  
#==============================================================#                                                                                  

bc-1.06.95-13.el7.x86_64
binutils-2.27-34.base.el7.x86_64
compat-libcap1-1.10-7.el7.x86_64
gcc-4.8.5-36.el7.x86_64
gcc-c++-4.8.5-36.el7.x86_64
elfutils-libelf-0.172-2.el7.x86_64
elfutils-libelf-devel-0.172-2.el7.x86_64
glibc-2.17-260.el7.x86_64
glibc-devel-2.17-260.el7.x86_64
libaio-0.3.109-13.el7.x86_64
libaio-devel-0.3.109-13.el7.x86_64
libgcc-4.8.5-36.el7.x86_64
libstdc++-4.8.5-36.el7.x86_64
libstdc++-devel-4.8.5-36.el7.x86_64
libxcb-1.13-1.el7.x86_64
libX11-1.6.5-2.el7.x86_64
libXau-1.0.8-2.1.el7.x86_64
libXi-1.7.9-1.el7.x86_64
libXrender-0.9.10-1.el7.x86_64
make-3.82-23.el7.x86_64
net-tools-2.0-0.24.20131004git.el7.x86_64
smartmontools-6.5-1.el7.x86_64
sysstat-10.1.5-17.el7.x86_64
e2fsprogs-1.42.9-13.el7.x86_64
e2fsprogs-libs-1.42.9-13.el7.x86_64
unzip-6.0-19.el7.x86_64
openssh-clients-7.4p1-16.el7.x86_64
readline-6.2-10.el7.x86_64
readline-devel-6.2-10.el7.x86_64
psmisc-22.20-15.el7.x86_64
ksh-20120801-139.el7.x86_64
nfs-utils-1.3.0-0.61.el7.x86_64
tar-1.26-35.el7.x86_64
device-mapper-multipath-0.4.9-123.el7.x86_64
avahi-0.6.31-19.el7.x86_64
ntp-4.2.6p5-28.el7.centos.x86_64
chrony-3.2-2.el7.x86_64
libXtst-1.2.3-1.el7.x86_64
libXrender-devel-0.9.10-1.el7.x86_64
fontconfig-devel-2.13.0-4.3.el7.x86_64
policycoreutils-2.5-29.el7.x86_64
policycoreutils-python-2.5-29.el7.x86_64

#==============================================================#                                                                                  
配置主机名                                                                                       
#==============================================================#                                                                                  

testos

#==============================================================#                                                                                  
配置 /etc/hosts 文件                                                                                  
#==============================================================#                                                                                  

127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.1.40 testos

## OracleBegin
## Public IP
192.168.1.40    testos

#==============================================================#                                                                                  
创建用户和组                                                                                    
#==============================================================#                                                                                  

oracle 用户：                                                                                      

uid=54321(oracle) gid=54321(oinstall) groups=54321(oinstall),54322(dba),54323(oper),54324(backupdba),54325(dgdba),54326(kmdba),54330(racdba)

rm: cannot remove ‘/oracle’: Device or resource busy

#==============================================================#                                                                                  
配置 Avahi-daemon 服务                                                                                  
#==============================================================#                                                                                  

● avahi-daemon.service - Avahi mDNS/DNS-SD Stack
   Loaded: loaded (/usr/lib/systemd/system/avahi-daemon.service; disabled; vendor preset: enabled)
   Active: inactive (dead)

#==============================================================#                                                                                  
配置透明大页 && NUMA && 磁盘 IO 调度器                                                                                  
#==============================================================#                                                                                  

args="ro crashkernel=auto rhgb quiet LANG=zh_CN.UTF-8 numa=off transparent_hugepage=never elevator=deadline"
-crashkernel=auto
-args="ro
args="ro crashkernel=auto rhgb quiet numa=off transparent_hugepage=never elevator=deadline"
-
-elevator=deadline"

#==============================================================#                                                                                  
配置 sysctl.conf                                                                                    
#==============================================================#                                                                                  

fs.aio-max-nr = 1048576
fs.file-max = 6815744
kernel.shmall = 2097152
kernel.shmmax = 8182046719
kernel.shmmni = 4096
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 9000 65500
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
vm.min_free_kbytes = 31961
net.ipv4.conf.ens33.rp_filter = 1
vm.swappiness = 10
kernel.panic_on_oops = 1
kernel.randomize_va_space = 2
kernel.numa_balancing = 0

#==============================================================#                                                                                  
配置 nsysctl.conf                                                                                   
#==============================================================#                                                                                  

NOZEROCONF=yes

#==============================================================#                                                                                  
配置 RemoveIPC                                                                                      
#==============================================================#                                                                                  

[Login]
RemoveIPC=no

#==============================================================#                                                                                  
配置 /etc/security/limits.conf 和 /etc/pam.d/login                                                                                  
#==============================================================#                                                                                  

查看 /etc/security/limits.conf：                                                                                  

oracle soft nofile 1024
oracle hard nofile 65536
oracle soft stack 10240
oracle hard stack 32768
oracle soft nproc 2047
oracle hard nproc 16384
oracle hard memlock unlimited
oracle soft memlock unlimited

查看 /etc/pam.d/login 文件：                                                                                  

auth [user_unknown=ignore success=ok ignore=ignore default=bad] pam_securetty.so
auth       substack     system-auth
auth       include      postlogin
account    required     pam_nologin.so
account    include      system-auth
password   include      system-auth
session    required     pam_selinux.so close
session    required     pam_loginuid.so
session    optional     pam_console.so
session    required     pam_selinux.so open
session    required     pam_namespace.so
session    optional     pam_keyinit.so force revoke
session    include      system-auth
session    include      postlogin
-session   optional     pam_ck_connector.so
session required pam_limits.so
session required /lib64/security/pam_limits.so

#==============================================================#                                                                                  
配置 /dev/shm                                                                                       
#==============================================================#                                                                                  

UUID=2fc28973-4e76-4d09-9954-68124d9f14e5 /                       xfs     defaults        0 0
UUID=65ce105b-2687-4f0d-ad6a-5dda8f0f51cb swap                    swap    defaults        0 0
/dev/oravg/oralv  /oracle  ext4  defaults  0 0
/swapfile none swap sw 0 0
tmpfs /dev/shm tmpfs size=7990280k 0 0

#==============================================================#                                                                                  
Root 用户环境变量                                                                                  
#==============================================================#                                                                                  

if [ -f ~/.bashrc ]; then
        . ~/.bashrc
fi
PATH=$PATH:$HOME/bin
export PATH
alias so='su - oracle'
export PS1="[`whoami`@`hostname`:"'$PWD]$ '

#==============================================================#                                                                                  
Oracle 用户环境变量                                                                                  
#==============================================================#                                                                                  

if [ -f ~/.bashrc ]; then
        . ~/.bashrc
fi
PATH=$PATH:$HOME/.local/bin:$HOME/bin
export PATH
umask 022
export TMP=/tmp
export TMPDIR=$TMP
export NLS_LANG=AMERICAN_AMERICA.AL32UTF8
export ORACLE_BASE=/oracle/app/oracle
export ORACLE_HOME=/oracle/app/oracle/product/11.2.0/db
export ORACLE_TERM=xterm
export TNS_ADMIN=$ORACLE_HOME/network/admin
export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export ORACLE_SID=testdb
export PATH=/usr/sbin:$PATH
export PATH=$ORACLE_HOME/bin:$ORACLE_HOME/OPatch:$ORACLE_HOME/perl/bin:$PATH
export PERL5LIB=$ORACLE_HOME/perl/lib
alias sas='sqlplus / as sysdba'
alias awr='sqlplus / as sysdba @?/rdbms/admin/awrrpt'
alias ash='sqlplus / as sysdba @?/rdbms/admin/ashrpt'
alias alert='vi $ORACLE_BASE/diag/rdbms/*/$ORACLE_SID/trace/alert_$ORACLE_SID.log'
export PS1="[`whoami`@`hostname`:"'$PWD]$ '
stty erase ^H

#==============================================================#                                                                                  
静默解压 Oracle 软件包                                                                                  
#==============================================================#                                                                                  

正在静默解压缩 Oracle 软件包，请稍等：                                                                                  

.---- -. -. .  .   .        .
( .',----- - - ' '      '                                         __
 \_/      ;--:-          __--------------------___  ____=========_||___
__U__n_^_''__[.  ooo___  | |_!_||_!_||_!_||_!_| |   |..|_i_|..|_i_|..|
c(_ ..(_ ..(_ ..( /,,,,,,] | |___||___||___||___| |   |                |
,_\___________'_|,L______],|______________________|_i,!________________!_i
/;_(@)(@)==(@)(@)   (o)(o)      (o)^(o)--(o)^(o)          (o)(o)-(o)(o)
""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"""~"'""

静默解压 Oracle 软件安装包： /software/p13390677_112040_Linux-x86-64_1of7.zip,/software/p13390677_112040_Linux-x86-64_2of7.zip                                                                                  

#==============================================================#                                                                                  
Oracle 安装静默文件                                                                                  
#==============================================================#                                                                                  

oracle.install.option=INSTALL_DB_SWONLY
UNIX_GROUP_NAME=oinstall
INVENTORY_LOCATION=/oracle/app/oraInventory
ORACLE_BASE=/oracle/app/oracle
oracle.install.db.InstallEdition=EE
oracle.install.db.DBA_GROUP=dba
oracle.install.db.OPER_GROUP=oper
oracle.install.responseFileVersion=/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0
SELECTED_LANGUAGES=en,zh_CN
ORACLE_HOME=/oracle/app/oracle/product/11.2.0/db
DECLINE_SECURITY_UPDATES=true
oracle.installer.autoupdates.option=SKIP_UPDATES

#==============================================================#                                                                                  
静默安装数据库软件                                                                                  
#==============================================================#                                                                                  

Starting Oracle Universal Installer...

Checking Temp space: must be greater than 120 MB.   Actual 87732 MB    Passed
Checking swap space: must be greater than 150 MB.   Actual 7628 MB    Passed
Preparing to launch Oracle Universal Installer from /tmp/OraInstall2024-01-14_01-38-11PM. Please wait ...You can find the log of this install session at:
 /oracle/app/oraInventory/logs/installActions2024-01-14_01-38-11PM.log

Prepare in progress.
..................................................   9% Done.

Prepare successful.

Copy files in progress.
..................................................   14% Done.
..................................................   20% Done.
..................................................   26% Done.
..................................................   31% Done.
..................................................   36% Done.
..................................................   41% Done.
..................................................   47% Done.
..................................................   52% Done.
..................................................   57% Done.
..................................................   63% Done.
..................................................   68% Done.
..................................................   73% Done.
..................................................   78% Done.
..................................................   83% Done.
..............................
Copy files successful.

Link binaries in progress.
..........
Link binaries successful.

Setup files in progress.
..................................................   88% Done.
..................................................   94% Done.

Setup files successful.
The installation of Oracle Database 11g was successful.
Please check '/oracle/app/oraInventory/logs/silentInstall2024-01-14_01-38-11PM.log' for more details.

Execute Root Scripts in progress.

As a root user, execute the following script(s):
        1. /oracle/app/oraInventory/orainstRoot.sh
        2. /oracle/app/oracle/product/11.2.0/db/root.sh


..................................................   100% Done.

Execute Root Scripts successful.
Successfully Setup Software.

#==============================================================#                                                                                  
执行 root 脚本                                                                                    
#==============================================================#                                                                                  

Changing permissions of /oracle/app/oraInventory.
Adding read,write permissions for group.
Removing read,write,execute permissions for world.

Changing groupname of /oracle/app/oraInventory to oinstall.
The execution of the script is complete.
Check /oracle/app/oracle/product/11.2.0/db/install/root_testos_2024-01-14_13-40-24.log for the output of root script

#==============================================================#                                                                                  
Oracle 软件版本                                                                                   
#==============================================================#                                                                                  


SQL*Plus: Release 11.2.0.4.0 Production


#==============================================================#                                                                                  
Oracle 补丁信息                                                                                   
#==============================================================#                                                                                  

There are no Interim patches installed in this Oracle Home.


#==============================================================#                                                                                  
配置监听                                                                                          
#==============================================================#                                                                                  


Parsing command line arguments:
    Parameter "silent" = true
    Parameter "responsefile" = /oracle/app/oracle/product/11.2.0/db/assistants/netca/netca.rsp
Done parsing command line arguments.
Oracle Net Services Configuration:
Profile configuration complete.
Oracle Net Listener Startup:
    Running Listener Control: 
      /oracle/app/oracle/product/11.2.0/db/bin/lsnrctl start LISTENER
    Listener Control complete.
    Listener started successfully.
Listener configuration complete.
Oracle Net Services configuration successful. The exit code is 0

检查监听状态：                                                                                  


LSNRCTL for Linux: Version 11.2.0.4.0 - Production on 14-JAN-2024 13:40:28

Copyright (c) 1991, 2013, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1521)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 11.2.0.4.0 - Production
Start Date                14-JAN-2024 13:40:27
Uptime                    0 days 0 hr. 0 min. 0 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /oracle/app/oracle/product/11.2.0/db/network/admin/listener.ora
Listener Log File         /oracle/app/oracle/diag/tnslsnr/testos/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=testos)(PORT=1521)))
The listener supports no services
The command completed successfully

#==============================================================#                                                                                  
静默建库命令                                                                                    
#==============================================================#                                                                                  

dbca -silent -createDatabase \
-templateName General_Purpose.dbc \
-responseFile NO_VALUE \
-gdbname testdb \
-sid testdb \
-sysPassword oracle \
-systemPassword oracle \
-redoLogFileSize 200 \
-datafileDestination /oracle/oradata \
-storageType FS \
-characterSet AL32UTF8 \
-nationalCharacterSet UTF8 \
-emConfiguration NONE \
-automaticMemoryManagement false \
-totalMemory 3901 \
-databaseType OLTP                                                                                  

#==============================================================#                                                                                  
创建数据库                                                                                       
#==============================================================#                                                                                  

Copying database files
1% complete
3% complete
11% complete
18% complete
26% complete
37% complete
Creating and starting Oracle instance
40% complete
45% complete
50% complete
55% complete
56% complete
60% complete
62% complete
Completing Database Creation
66% complete
70% complete
73% complete
85% complete
96% complete
100% complete
Look at the log file "/oracle/app/oracle/cfgtoollogs/dbca/testdb/testdb.log" for further details.
stty: standard input: Inappropriate ioctl for device

#==============================================================#                                                                                  
配置在线重做日志                                                                                  
#==============================================================#                                                                                  

stty: standard input: Inappropriate ioctl for device
数据库在线重做日志文件：                                                                                  

stty: standard input: Inappropriate ioctl for device

   THREAD#     GROUP# MEMBER                                                                                                                   size(M)
---------- ---------- ------------------------------------------------------------------------------------------------------------------------ ----------
         1          1 /oracle/oradata/testdb/redo01.log                                                                                            200
         1          2 /oracle/oradata/testdb/redo02.log                                                                                            200
         1          3 /oracle/oradata/testdb/redo03.log                                                                                            200
         1         11 /oracle/oradata/TESTDB/onlinelog/o1_mf_11_lt6x32cp_.log                                                                      200
         1         11 /oracle/app/oracle/fast_recovery_area/TESTDB/onlinelog/o1_mf_11_lt6x32j9_.log                                                200
         1         12 /oracle/oradata/TESTDB/onlinelog/o1_mf_12_lt6x32qc_.log                                                                      200
         1         12 /oracle/app/oracle/fast_recovery_area/TESTDB/onlinelog/o1_mf_12_lt6x32x3_.log                                                200
         1         13 /oracle/oradata/TESTDB/onlinelog/o1_mf_13_lt6x334q_.log                                                                      200
         1         13 /oracle/app/oracle/fast_recovery_area/TESTDB/onlinelog/o1_mf_13_lt6x33hz_.log                                                200
         1         14 /oracle/oradata/TESTDB/onlinelog/o1_mf_14_lt6x33s1_.log                                                                      200
         1         14 /oracle/app/oracle/fast_recovery_area/TESTDB/onlinelog/o1_mf_14_lt6x343v_.log                                                200
         1         15 /oracle/oradata/TESTDB/onlinelog/o1_mf_15_lt6x34fm_.log                                                                      200
         1         15 /oracle/app/oracle/fast_recovery_area/TESTDB/onlinelog/o1_mf_15_lt6x34om_.log                                                200

#==============================================================#                                                                                  
配置 RMAN 备份任务                                                                                  
#==============================================================#                                                                                  

## OracleBegin
00 02 * * * /home/oracle/scripts/del_arch.sh
#00 00 * * 0 /home/oracle/scripts/dbbackup_lv0.sh
#00 00 * * 1,2,3,4,5,6 /home/oracle/scripts/dbbackup_lv1.sh

#==============================================================#                                                                                  
配置 glogin.sql                                                                                     
#==============================================================#                                                                                  

define _editor=vi
set serveroutput on size 1000000
set pagesize 9999
set long 99999
set trimspool on
col name format a80
set termout off
define gname=idle
column global_name new_value gname
select lower(user) || '@' || substr( global_name, 1, decode( dot, 0, length(global_name), dot-1) ) global_name from (select global_name, instr(global_name,'.') dot from global_name );
ALTER SESSION SET nls_date_format = 'YYYY-MM-DD HH24:MI:SS';
set sqlprompt '&gname _DATE> '
set termout on

#==============================================================#                                                                                  
优化数据库参数                                                                                  
#==============================================================#                                                                                  

stty: standard input: Inappropriate ioctl for device
stty: standard input: Inappropriate ioctl for device
数据库参数：                                                                                    

stty: standard input: Inappropriate ioctl for device

NAME                                               SID        SPVALUE                                                                          VALUE
-------------------------------------------------- ---------- -------------------------------------------------------------------------------- --------------------------------------------------------------------------------
_b_tree_bitmap_plans                               *          FALSE                                                                            FALSE
_datafile_write_errors_crash_instance              *          FALSE                                                                            FALSE
audit_file_dest                                    *          /oracle/app/oracle/admin/testdb/adump                                            /oracle/app/oracle/admin/testdb/adump
audit_trail                                        *          NONE                                                                             DB
compatible                                         *          11.2.0.4.0                                                                       11.2.0.4.0
control_file_record_keep_time                      *          31                                                                               31
db_block_size                                      *          8192                                                                             8192
db_create_file_dest                                *          /oracle/oradata                                                                  /oracle/oradata
db_file_multiblock_read_count                      *                                                                                           128
db_files                                           *          5000                                                                             200
db_name                                            *          testdb                                                                           testdb
db_recovery_file_dest                              *          /oracle/app/oracle/fast_recovery_area                                            /oracle/app/oracle/fast_recovery_area
db_recovery_file_dest_size                         *          5800722432                                                                       5800722432
db_writer_processes                                *                                                                                           1
deferred_segment_creation                          *          FALSE                                                                            FALSE
diagnostic_dest                                    *          /oracle/app/oracle                                                               /oracle/app/oracle
dispatchers                                        *          (PROTOCOL=TCP) (SERVICE=testdbXDB)                                               (PROTOCOL=TCP) (SERVICE=testdbXDB)
enable_ddl_logging                                 *          TRUE                                                                             FALSE
event                                              *          10949 trace name context forever,level 1
event                                              *          28401 trace name context forever,level 1
fast_start_parallel_rollback                       *                                                                                           LOW
log_archive_dest_1                                 *          location=/oracle/oradata/archivelog                                              location=/oracle/oradata/archivelog
log_archive_format                                 *          %t_%s_%r.dbf                                                                     %t_%s_%r.dbf
max_dump_file_size                                 *                                                                                           unlimited
open_cursors                                       *          1000                                                                             300
optimizer_index_caching                            *                                                                                           0
optimizer_mode                                     *                                                                                           ALL_ROWS
parallel_force_local                               *                                                                                           FALSE
parallel_max_servers                               *          64                                                                               64
pga_aggregate_target                               *          1308622848                                                                       817889280
processes                                          *          2000                                                                             150
remote_login_passwordfile                          *          EXCLUSIVE                                                                        EXCLUSIVE
resource_limit                                     *          TRUE                                                                             FALSE
resource_manager_plan                              *          force:
sec_case_sensitive_logon                           *          FALSE                                                                            TRUE
session_cached_cursors                             *          300                                                                              50
sessions                                           *                                                                                           248
sga_max_size                                       *          5235539968                                                                       3271557120
sga_target                                         *          5235539968                                                                       3271557120
spfile                                             *                                                                                           /oracle/app/oracle/product/11.2.0/db/dbs/spfiletestdb.ora
statistics_level                                   *                                                                                           TYPICAL
undo_retention                                     *          10800                                                                            900

恭喜！Oracle 单机安装成功，现在是否重启主机：[Y/N] Y

正在重启 ......                                                                                   
~~~

### 后期调整

环境变量调整

~~~shell
cat >> /home/oracle/.bash_profile << "EOF"
alias sqlplus="rlwrap sqlplus"
alias rman="rlwrap rman"
EOF
~~~

配置glogin.sql

~~~shell
cat > /oracle/app/oracle/product/11.2.0/db/sqlplus/admin/glogin.sql << "EOF"
set serveroutput on size 1000000
set long 99999
set pagesize 1000
set linesize 100
set termout off
alter session set nls_date_format='yyyy-mm-dd hh24:mi:ss';
alter session set nls_timestamp_format='yyyy-mm-dd hh24:mi:ss';
define gname=idle
column global_name new_value gname
select lower(user)||'@'||lower(instance_name)||'('||lower(host_name)||')' global_name from v$instance;
set sqlprompt '&gname> '
set termout on
EOF
~~~

调整日志组

~~~sql
-- 删除多余的redo日志组
alter database drop logfile group 11;
alter database drop logfile group 12;
alter database drop logfile group 13;
alter database drop logfile group 14;
alter database drop logfile group 15;
-- 创建redo日志组
alter database add logfile group 4 '/oracle/oradata/testdb/redo04.log' size 200m;
alter database add logfile group 5 '/oracle/oradata/testdb/redo05.log' size 200m;
~~~

调整参数

~~~sql
alter system set log_archive_dest_1='' scope=spfile sid='*';
alter system set db_create_file_dest='' scope=spfile sid='*';
alter system set db_recovery_file_dest='/oracle/archive' scope=spfile sid='*';
~~~

删除相关目录

~~~shell
rm -rf /oracle/oradata/archivelog
rm -rf /oracle/oradata/TESTDB
rm -rf /oracle/app/oracle/fast_recovery_area/TESTDB
~~~

重启数据库

~~~sql
sys@testdb(testos)> shutdown immediate
sys@testdb(testos)> startup
~~~



# RAC

## 11g

### 准备工作

1. Windows上安装Starwind创建虚拟磁盘

   参考：https://mp.weixin.qq.com/s/xjYZmGcwshbJBICcr0xvBw

2. linux识别创建的虚拟磁盘

3. linux配置yum源

4. 上传安装脚本和安装包补丁包

5. 执行脚本进行安装





**Linux 通过 ISCSI 连接共享存储**

```shell
#1、Linux 客户端安装 ISCSI 依赖
yum install -y iscsi-initiator-utils*

#2、搜索服务端 ISCSI Target
[root@testosa ~]# iscsiadm -m discovery -t st -p 192.168.1.88
192.168.1.88:3260,-1 iqn.2008-08.com.starwindsoftware:192.168.1.88-kahn

#3、连接服务端 ISCSI 共享存储
[root@testosa ~]# iscsiadm -m node -T iqn.2008-08.com.starwindsoftware:192.168.1.88-kahn -p 192.168.1.88 -l
Logging in to [iface: default, target: iqn.2008-08.com.starwindsoftware:192.168.1.88-kahn, portal: 192.168.1.88,3260] (multiple)
Login to [iface: default, target: iqn.2008-08.com.starwindsoftware:192.168.1.88-kahn, portal: 192.168.1.88,3260] successful.

#4、Linux 客户端查看共享存储
[root@testosa ~]# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk
├─sda1   8:1    0  7.5G  0 part [SWAP]
└─sda2   8:2    0 92.6G  0 part /
sdb      8:16   0    1G  0 disk
sdc      8:32   0    5G  0 disk
sr0     11:0    1  4.3G  0 rom  /mnt
```

如上sdb和sdc就是共享存储



### 环境信息

节点1

```shell
[root@testosa ~]# cat /etc/os-release
NAME="CentOS Linux"
VERSION="7 (Core)"
ID="centos"
ID_LIKE="rhel fedora"
VERSION_ID="7"
PRETTY_NAME="CentOS Linux 7 (Core)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:centos:centos:7"
HOME_URL="https://www.centos.org/"
BUG_REPORT_URL="https://bugs.centos.org/"

CENTOS_MANTISBT_PROJECT="CentOS-7"
CENTOS_MANTISBT_PROJECT_VERSION="7"
REDHAT_SUPPORT_PRODUCT="centos"
REDHAT_SUPPORT_PRODUCT_VERSION="7"

[root@testosa ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:49:22:56 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.61/24 brd 192.168.1.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::1bc0:7045:ce96:b08c/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: ens35: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:49:22:60 brd ff:ff:ff:ff:ff:ff
    inet 1.1.1.3/24 brd 1.1.1.255 scope global noprefixroute dynamic ens35
       valid_lft 1427sec preferred_lft 1427sec
    inet6 fe80::9cd3:53be:a22f:81f9/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
[root@testosa ~]#
[root@testosa ~]#
[root@testosa ~]# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk
├─sda1   8:1    0  7.5G  0 part [SWAP]
└─sda2   8:2    0 92.6G  0 part /
sdb      8:16   0    1G  0 disk
sdc      8:32   0    5G  0 disk
sr0     11:0    1  4.3G  0 rom  /mnt
[root@testosa ~]#
```

节点2

```shell
[root@testosb ~]# cat /etc/os-release
NAME="CentOS Linux"
VERSION="7 (Core)"
ID="centos"
ID_LIKE="rhel fedora"
VERSION_ID="7"
PRETTY_NAME="CentOS Linux 7 (Core)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:centos:centos:7"
HOME_URL="https://www.centos.org/"
BUG_REPORT_URL="https://bugs.centos.org/"

CENTOS_MANTISBT_PROJECT="CentOS-7"
CENTOS_MANTISBT_PROJECT_VERSION="7"
REDHAT_SUPPORT_PRODUCT="centos"
REDHAT_SUPPORT_PRODUCT_VERSION="7"

[root@testosb ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:1a:ae:ff brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.62/24 brd 192.168.1.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::1bc0:7045:ce96:b08c/64 scope link tentative noprefixroute dadfailed
       valid_lft forever preferred_lft forever
    inet6 fe80::a046:3df0:c64c:a123/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: ens35: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:1a:ae:09 brd ff:ff:ff:ff:ff:ff
    inet 1.1.1.4/24 brd 1.1.1.255 scope global noprefixroute dynamic ens35
       valid_lft 1375sec preferred_lft 1375sec
    inet6 fe80::ef57:7744:dfa0:fe89/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
[root@testosb ~]#
[root@testosb ~]# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk
├─sda1   8:1    0  7.5G  0 part [SWAP]
└─sda2   8:2    0 92.6G  0 part /
sdb      8:16   0    1G  0 disk
sdc      8:32   0    5G  0 disk
sr0     11:0    1  4.3G  0 rom  /mnt
[root@testosb ~]#       
```





### 上传软件安装包和一键安装脚本

~~~shell
#创建软件存放目录
[root@testosa ~]# mkdir -p /soft
[root@testosa ~]# cd /soft
[root@testosa soft]# chmod +x OracleShellInstall
[root@testosa soft]# ll
total 5123916
-rwxr-xr-x. 1 grid oinstall     208290 May 26 15:54 OracleShellInstall
-rw-r--r--. 1 grid oinstall 1395582860 May 26 15:01 p13390677_112040_Linux-x86-64_1of7.zip
-rw-r--r--. 1 grid oinstall 1151304589 May 26 15:03 p13390677_112040_Linux-x86-64_2of7.zip
-rw-r--r--. 1 grid oinstall 1205251894 May 26 15:05 p13390677_112040_Linux-x86-64_3of7.zip
-rw-r--r--. 1 grid oinstall  174911877 May 26 15:11 p18370031_112040_Linux-x86-64.zip
-rw-r--r--  1 root root     1319414278 May 26 19:19 p31718723_112040_Linux-x86-64.zip
-rw-r--r--  1 root root      122976179 May 26 19:23 p6880880_112000_Linux-x86-64.zip
[root@testosa soft]# 
[root@testos soft]# cd
#确定要挂载光盘镜像，安装过程过程中会安装依赖：  mount /dev/cdrom /mnt
[root@testosa ~]# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda2        93G  5.5G   88G   6% /
devtmpfs        3.8G     0  3.8G   0% /dev
tmpfs           3.9G     0  3.9G   0% /dev/shm
tmpfs           3.9G   12M  3.8G   1% /run
tmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup
tmpfs           781M     0  781M   0% /run/user/0
/dev/sr0        4.3G  4.3G     0 100% /mnt
[root@testosa ~]#
~~~



### 安装完整过程

```shell
./OracleShellInstall -n testos `# hostname prefix`\
-hn testos1,testos2 `# rac node hostname`\
-cn rac-cls `# cluster_name`\
-sn rac-scan `# scan_name`\
-rp rootroot `# root password`\
-gp oracle `# grid password`\
-op oracle `# oracle password`\
-lf ens33 `# local ip ifname`\
-pf ens35 `# rac private ip ifname`\
-ri 192.168.1.61,192.168.1.62 `# rac node public ip`\
-vi 192.168.1.63,192.168.1.64 `# rac virtual ip`\
-si 192.168.1.65 `# rac scan ip`\
-od /dev/sdb `# rac ocr asm disk`\
-dd /dev/sdc `# rac data asm disk`\
-o testdb `# dbname`\
-ds AL32UTF8 `# database character`\
-ns AL16UTF16 `# national character`\
-dp oracle `# sys/system password`\
-redo 50 `# redo size`\
-opd Y `# optimize db`\
-gpa 31718723 `# grid PSU/RU`
```



大概耗时

```shell
[root@testos1 soft]# ./OracleShellInstall -n testos `# hostname prefix`\
> -hn testos1,testos2 `# rac node hostname`\
> -cn rac-cls `# cluster_name`\
> -sn rac-scan `# scan_name`\
> -rp rootroot `# root password`\
> -gp oracle `# grid password`\
> -op oracle `# oracle password`\
> -lf ens33 `# local ip ifname`\
> -pf ens35 `# rac private ip ifname`\
> -ri 192.168.1.61,192.168.1.62 `# rac node public ip`\
> -vi 192.168.1.63,192.168.1.64 `# rac virtual ip`\
> -si 192.168.1.65 `# rac scan ip`\
> -od /dev/sdb `# rac ocr asm disk`\
> -dd /dev/sdc `# rac data asm disk`\
> -o testdb `# dbname`\
> -ds AL32UTF8 `# database character`\
> -ns AL16UTF16 `# national character`\
> -dp oracle `# sys/system password`\
> -redo 50 `# redo size`\
> -opd Y `# optimize db`\
> -gpa 31718723 `# grid PSU/RU`

   ███████                             ██          ████████ ██               ██  ██ ██                    ██              ██  ██
  ██░░░░░██                           ░██         ██░░░░░░ ░██              ░██ ░██░██                   ░██             ░██ ░██
 ██     ░░██ ██████  ██████    █████  ░██  █████ ░██       ░██       █████  ░██ ░██░██ ███████   ██████ ██████  ██████   ░██ ░██
░██      ░██░░██░░█ ░░░░░░██  ██░░░██ ░██ ██░░░██░█████████░██████  ██░░░██ ░██ ░██░██░░██░░░██ ██░░░░ ░░░██░  ░░░░░░██  ░██ ░██
░██      ░██ ░██ ░   ███████ ░██  ░░  ░██░███████░░░░░░░░██░██░░░██░███████ ░██ ░██░██ ░██  ░██░░█████   ░██    ███████  ░██ ░██
░░██     ██  ░██    ██░░░░██ ░██   ██ ░██░██░░░░        ░██░██  ░██░██░░░░  ░██ ░██░██ ░██  ░██ ░░░░░██  ░██   ██░░░░██  ░██ ░██
 ░░███████  ░███   ░░████████░░█████  ███░░██████ ████████ ░██  ░██░░██████ ███ ███░██ ███  ░██ ██████   ░░██ ░░████████ ███ ███
  ░░░░░░░   ░░░     ░░░░░░░░  ░░░░░  ░░░  ░░░░░░ ░░░░░░░░  ░░   ░░  ░░░░░░ ░░░ ░░░ ░░ ░░░   ░░ ░░░░░░     ░░   ░░░░░░░░ ░░░ ░░░


注意：本脚本仅用于新服务器上实施部署数据库使用，严禁在已运行数据库的主机上执行，以免发生数据丢失或者损坏，造成不可挽回的损失！！！                                                     

请选择安装模式 [单机(si)/单机ASM(sa)/集群(rac)] : rac

数据库安装模式: rac

请选择数据库版本 [11/12/19/21] : 11

数据库版本:     11

OracleShellInstall 开始安装，详细安装过程可查看日志： tail -2000f /soft/print_ora_install_20240527205323.log                                                                           

正在去除密码复杂度配置......已完成 (耗时: 0 秒)
正在配置 YUM 源......已完成 (耗时: 0 秒)
配置 root 用户互信......已完成 (耗时: 4 秒)
正在检查并更新 RAC 主机时间......已完成 (耗时: 1 秒)
正在获取操作系统信息......已完成 (耗时: 0 秒)
正在配置 Swap......已完成 (耗时: 3 秒)
正在配置防火墙......已完成 (耗时: 1 秒)
正在配置 selinux......已完成 (耗时: 0 秒)
正在配置 nsyctl......已完成 (耗时: 1 秒)
正在安装依赖包......已完成 (耗时: 20 秒)
正在配置主机名和 /etc/hosts......已完成 (耗时: 0 秒)
正在创建用户和组......已完成 (耗时: 1 秒)
正在创建安装目录......已完成 (耗时: 0 秒)
正在配置 Avahi-daemon 服务......已完成 (耗时: 1 秒)
正在配置透明大页 && NUMA && 磁盘 IO 调度器......已完成 (耗时: 1 秒)
正在配置操作系统参数 sysctl......已完成 (耗时: 1 秒)
正在配置 RemoveIPC......已完成 (耗时: 1 秒)
正在配置用户限制 limit......已完成 (耗时: 1 秒)
正在配置 shm 目录......已完成 (耗时: 1 秒)
正在配置用户环境变量......已完成 (耗时: 1 秒)
正在配置 RAC 其他节点信息......已完成 (耗时: 43 秒)
正在配置 RAC 所有节点互信......已完成 (耗时: 10 秒)
正在解压 Grid 安装包以及补丁......已完成 (耗时: 196 秒)
正在解压 Oracle 软件以及补丁......已完成 (耗时: 98 秒)
正在安装 Grid 软件以及补丁......已完成 (耗时: 2565 秒)
正在创建 ASM 磁盘组......已完成 (耗时: 38 秒)
正在安装 Oracle 软件以及补丁......已完成 (耗时: 1099 秒)
正在创建数据库......已完成 (耗时: 641 秒)
正在优化数据库......已完成 (耗时: 239 秒)

恭喜！Oracle RAC 安装成功 (耗时: 5069 秒)，现在是否重启主机：[Y/N] Y

正在重启节点 192.168.1.62 主机......

Connection to 192.168.1.62 closed by remote host.
正在重启当前节点主机......
```

## 19c-pdb

### 准备工作

1. Windows上安装Starwind创建虚拟磁盘

   参考：https://mp.weixin.qq.com/s/xjYZmGcwshbJBICcr0xvBw

2. linux识别创建的虚拟磁盘

3. linux配置yum源

4. 上传安装脚本和安装包补丁包

5. 执行脚本进行安装





**Linux 通过 ISCSI 连接共享存储**

```shell
#1、Linux 客户端安装 ISCSI 依赖
yum install -y iscsi-initiator-utils*

#2、搜索服务端 ISCSI Target
[root@testos81 ~]# iscsiadm -m discovery -t st -p 192.168.1.86
192.168.1.86:3260,-1 iqn.2008-08.com.starwindsoftware:192.168.1.86-kahn
[root@testos81 ~]#

#3、连接服务端 ISCSI 共享存储
[root@testos81 ~]# iscsiadm -m node -T iqn.2008-08.com.starwindsoftware:192.168.1.86-kahn -p 192.168.1.86 -l
Logging in to [iface: default, target: iqn.2008-08.com.starwindsoftware:192.168.1.86-kahn, portal: 192.168.1.86,3260] (multiple)
Login to [iface: default, target: iqn.2008-08.com.starwindsoftware:192.168.1.86-kahn, portal: 192.168.1.86,3260] successful.
[root@testos81 ~]#

#4、Linux 客户端查看共享存储
[root@testos81 ~]# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk
├─sda1   8:1    0    2G  0 part /boot
├─sda2   8:2    0 74.5G  0 part /
└─sda3   8:3    0  7.5G  0 part [SWAP]
sdb      8:16   0  200G  0 disk
sdc      8:32   0    5G  0 disk
sdd      8:48   0   15G  0 disk
sr0     11:0    1  4.3G  0 rom  /mnt
[root@testos81 ~]#
```

如上sdc和sdd就是共享存储



### 环境信息

节点1

```shell
[root@testos81 ~]# cat /etc/os-release
NAME="CentOS Linux"
VERSION="7 (Core)"
ID="centos"
ID_LIKE="rhel fedora"
VERSION_ID="7"
PRETTY_NAME="CentOS Linux 7 (Core)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:centos:centos:7"
HOME_URL="https://www.centos.org/"
BUG_REPORT_URL="https://bugs.centos.org/"

CENTOS_MANTISBT_PROJECT="CentOS-7"
CENTOS_MANTISBT_PROJECT_VERSION="7"
REDHAT_SUPPORT_PRODUCT="centos"
REDHAT_SUPPORT_PRODUCT_VERSION="7"

[root@testos81 ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:9a:34:50 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.81/24 brd 192.168.1.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::f27e:98bb:2b64:1b2e/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: ens36: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:9a:34:5a brd ff:ff:ff:ff:ff:ff
    inet 1.1.1.23/24 brd 1.1.1.255 scope global noprefixroute ens36
       valid_lft forever preferred_lft forever
    inet6 fe80::d847:26cb:3000:bfa6/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
4: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:4f:f1:d2 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
5: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000
    link/ether 52:54:00:4f:f1:d2 brd ff:ff:ff:ff:ff:ff
[root@testos81 ~]# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk
├─sda1   8:1    0    2G  0 part /boot
├─sda2   8:2    0 74.5G  0 part /
└─sda3   8:3    0  7.5G  0 part [SWAP]
sdb      8:16   0  200G  0 disk
sdc      8:32   0    5G  0 disk
sdd      8:48   0   15G  0 disk
sr0     11:0    1  4.3G  0 rom  /mnt
[root@testos81 ~]#
```

节点2

```shell
[root@testos82 ~]# cat /etc/os-release
NAME="CentOS Linux"
VERSION="7 (Core)"
ID="centos"
ID_LIKE="rhel fedora"
VERSION_ID="7"
PRETTY_NAME="CentOS Linux 7 (Core)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:centos:centos:7"
HOME_URL="https://www.centos.org/"
BUG_REPORT_URL="https://bugs.centos.org/"

CENTOS_MANTISBT_PROJECT="CentOS-7"
CENTOS_MANTISBT_PROJECT_VERSION="7"
REDHAT_SUPPORT_PRODUCT="centos"
REDHAT_SUPPORT_PRODUCT_VERSION="7"

[root@testos82 ~]# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:fc:fd:ac brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.82/24 brd 192.168.1.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::f27e:98bb:2b64:1b2e/64 scope link tentative noprefixroute dadfailed
       valid_lft forever preferred_lft forever
    inet6 fe80::9302:b4c8:657f:3cb3/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: ens36: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 00:0c:29:fc:fd:b6 brd ff:ff:ff:ff:ff:ff
    inet 1.1.1.24/24 brd 1.1.1.255 scope global noprefixroute ens36
       valid_lft forever preferred_lft forever
    inet6 fe80::d847:26cb:3000:bfa6/64 scope link tentative noprefixroute dadfailed
       valid_lft forever preferred_lft forever
    inet6 fe80::8d80:52c3:51e6:42fb/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
4: virbr0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 52:54:00:c0:46:82 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
5: virbr0-nic: <BROADCAST,MULTICAST> mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000
    link/ether 52:54:00:c0:46:82 brd ff:ff:ff:ff:ff:ff
[root@testos82 ~]# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk
├─sda1   8:1    0    2G  0 part /boot
├─sda2   8:2    0 74.5G  0 part /
└─sda3   8:3    0  7.5G  0 part [SWAP]
sdb      8:16   0  200G  0 disk
sr0     11:0    1  4.3G  0 rom  /mnt
[root@testos82 ~]#    
```





### 上传软件安装包和一键安装脚本

~~~shell
#创建软件存放目录
[root@testos81 ~]# mkdir -p /soft
[root@testos81 ~]# cd /soft
[root@testos81 soft]# chmod +x OracleShellInstall
[root@testos81 soft]# ll
total 9396420
-rw-r--r--. 1 root root 3059705302 Jun 11 21:42 LINUX.X64_193000_db_home.zip
-rw-r--r--. 1 root root 2889184573 Jun 11 21:51 LINUX.X64_193000_grid_home.zip
-rwxr-xr-x. 1 root root     208290 Jun 11 21:36 OracleShellInstall
-rw-r--r--. 1 root root  127475677 Jun 11 21:58 p36199232_190000_Linux-x86-64.zip
-rw-r--r--. 1 root root 3411816300 Jun 11 22:03 p36233126_190000_Linux-x86-64.zip
-rw-r--r--. 1 root root  133535622 Jun 11 21:58 p6880880_190000_Linux-x86-64.zip
[root@testos81 soft]#
[root@testos81 soft]# cd
#确定要挂载光盘镜像，安装过程过程中会安装依赖：  mount /dev/cdrom /mnt
[root@testos81 soft]# df -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda2        75G   14G   62G  18% /
devtmpfs        3.8G     0  3.8G   0% /dev
tmpfs           3.9G     0  3.9G   0% /dev/shm
tmpfs           3.9G   13M  3.8G   1% /run
tmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup
/dev/sda1       2.0G  155M  1.9G   8% /boot
tmpfs           781M     0  781M   0% /run/user/0
/dev/sr0        4.3G  4.3G     0 100% /mnt
[root@testos81 soft]#
~~~



### 安装完整过程

```shell
./OracleShellInstall -n testos `# hostname prefix`\
-hn testos81,testos82 `# rac node hostname`\
-cn rac-cls `# cluster_name`\
-sn rac-scan `# scan_name`\
-rp rootroot `# root password`\
-gp oracle `# grid password`\
-op oracle `# oracle password`\
-lf ens33 `# local ip ifname`\
-pf ens36 `# rac private ip ifname`\
-ri 192.168.1.81,192.168.1.82 `# rac node public ip`\
-vi 192.168.1.83,192.168.1.84 `# rac virtual ip`\
-si 192.168.1.85 `# rac scan ip`\
-od /dev/sdc `# rac ocr asm disk`\
-dd /dev/sdd `# rac data asm disk`\
-o testdb `# dbname`\
-pdb testpdb `# pdbname`\
-ds AL32UTF8 `# database character`\
-ns AL16UTF16 `# national character`\
-redo 100 `# redo size`\
-dp oracle `# sys/system password`\
-gpa 36233126 `# grid PSU/RU`\
-jpa 36199232 `# OJVM PSU/RU`\
-opd Y `# optimize db`
```



大概耗时

```shell
[root@testos81 soft]# ./OracleShellInstall -n testos `# hostname prefix`\
> -hn testos81,testos82 `# rac node hostname`\
> -cn rac-cls `# cluster_name`\
> -sn rac-scan `# scan_name`\
> -rp rootroot `# root password`\
> -gp oracle `# grid password`\
> -op oracle `# oracle password`\
> -lf ens33 `# local ip ifname`\
> -pf ens36 `# rac private ip ifname`\
> -ri 192.168.1.81,192.168.1.82 `# rac node public ip`\
> -vi 192.168.1.83,192.168.1.84 `# rac virtual ip`\
> -si 192.168.1.85 `# rac scan ip`\
> -od /dev/sdc `# rac ocr asm disk`\
> -dd /dev/sdd `# rac data asm disk`\
> -o testdb `# dbname`\
> -pdb testpdb `# pdbname`\
> -ds AL32UTF8 `# database character`\
> -ns AL16UTF16 `# national character`\
> -redo 100 `# redo size`\
> -dp oracle `# sys/system password`\
> -gpa 36233126 `# grid PSU/RU`\
> -jpa 36199232 `# OJVM PSU/RU`\
> -opd Y `# optimize db`

   ███████                             ██          ████████ ██               ██  ██ ██                    ██              ██  ██
  ██░░░░░██                           ░██         ██░░░░░░ ░██              ░██ ░██░██                   ░██             ░██ ░██
 ██     ░░██ ██████  ██████    █████  ░██  █████ ░██       ░██       █████  ░██ ░██░██ ███████   ██████ ██████  ██████   ░██ ░██
░██      ░██░░██░░█ ░░░░░░██  ██░░░██ ░██ ██░░░██░█████████░██████  ██░░░██ ░██ ░██░██░░██░░░██ ██░░░░ ░░░██░  ░░░░░░██  ░██ ░██
░██      ░██ ░██ ░   ███████ ░██  ░░  ░██░███████░░░░░░░░██░██░░░██░███████ ░██ ░██░██ ░██  ░██░░█████   ░██    ███████  ░██ ░██
░░██     ██  ░██    ██░░░░██ ░██   ██ ░██░██░░░░        ░██░██  ░██░██░░░░  ░██ ░██░██ ░██  ░██ ░░░░░██  ░██   ██░░░░██  ░██ ░██
 ░░███████  ░███   ░░████████░░█████  ███░░██████ ████████ ░██  ░██░░██████ ███ ███░██ ███  ░██ ██████   ░░██ ░░████████ ███ ███
  ░░░░░░░   ░░░     ░░░░░░░░  ░░░░░  ░░░  ░░░░░░ ░░░░░░░░  ░░   ░░  ░░░░░░ ░░░ ░░░ ░░ ░░░   ░░ ░░░░░░     ░░   ░░░░░░░░ ░░░ ░░░


注意：本脚本仅用于新服务器上实施部署数据库使用，严禁在已运行数据库的主机上执行，以免发生数据丢失或者损坏，造成不可挽回的损失！！！                                                     

请选择安装模式 [单机(si)/单机ASM(sa)/集群(rac)] : rac

数据库安装模式: rac

请选择数据库版本 [11/12/19/21] : 19

数据库版本:     19

OracleShellInstall 开始安装，详细安装过程可查看日志： tail -2000f /soft/print_ora_install_20240612081118.log                                                                           

正在去除密码复杂度配置......已完成 (耗时: 0 秒)
正在配置 YUM 源......已完成 (耗时: 1 秒)
配置 root 用户互信......已完成 (耗时: 4 秒)
正在检查并更新 RAC 主机时间......已完成 (耗时: 1 秒)
正在获取操作系统信息......已完成 (耗时: 0 秒)
正在配置 Swap......已完成 (耗时: 3 秒)
正在配置防火墙......已完成 (耗时: 1 秒)
正在配置 selinux......已完成 (耗时: 0 秒)
正在配置 nsyctl......已完成 (耗时: 0 秒)
正在安装依赖包......已完成 (耗时: 30 秒)
正在配置主机名和 /etc/hosts......已完成 (耗时: 0 秒)
正在创建用户和组......已完成 (耗时: 1 秒)
正在创建安装目录......已完成 (耗时: 0 秒)
正在配置 Avahi-daemon 服务......已完成 (耗时: 1 秒)
正在配置透明大页 && NUMA && 磁盘 IO 调度器......已完成 (耗时: 1 秒)
正在配置操作系统参数 sysctl......已完成 (耗时: 1 秒)
正在配置 RemoveIPC......已完成 (耗时: 1 秒)
正在配置用户限制 limit......已完成 (耗时: 1 秒)
正在配置 shm 目录......已完成 (耗时: 1 秒)
正在配置用户环境变量......已完成 (耗时: 1 秒)
正在配置 RAC 其他节点信息......已完成 (耗时: 142 秒)
正在配置 RAC 所有节点互信......已完成 (耗时: 11 秒)
正在解压 Grid 安装包以及补丁......已完成 (耗时: 205 秒)
正在解压 Oracle 软件以及补丁......已完成 (耗时: 114 秒)
正在安装 Grid 软件以及补丁......已完成 (耗时: 1771 秒)
正在创建 ASM 磁盘组......已完成 (耗时: 48 秒)
正在安装 Oracle 软件以及补丁......已完成 (耗时: 1623 秒)
正在创建数据库......已完成 (耗时: 6423 秒)
正在优化数据库......已完成 (耗时: 391 秒)

恭喜！Oracle RAC 安装成功 (耗时: 10787 秒)，现在是否重启主机：[Y/N] Y

正在重启节点 192.168.1.82 主机......

Connection to 192.168.1.82 closed by remote host.
正在重启当前节点主机......
```



# 参考资料

Starwind 配置 ISCSI 共享存储

https://mp.weixin.qq.com/s/xjYZmGcwshbJBICcr0xvBw

11GR2 rac 2节点一键安装演示

https://www.modb.pro/db/1767103571552702464

RedHat 7.9 一键安装 Oracle 11GR2 RAC

https://www.modb.pro/db/1793915831289712640





# 限制和说明

## 必须有/boot分区

如下：如果没有/boot分区，以下命令会报错，导致安装脚本失败

```shell
[root@testos2 ~]# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  100G  0 disk
├─sda1   8:1    0  7.5G  0 part [SWAP]
└─sda2   8:2    0 92.6G  0 part /
sdb      8:16   0    1G  0 disk
sdc      8:32   0    5G  0 disk
sr0     11:0    1  4.3G  0 rom
[root@testos2 ~]#
[root@testos2 ~]# lsblk -no PKNAME "$(findmnt -n -o SOURCE /boot)"
lsblk: : not a block device
```

正常情况

```shell
[root@testos1:/root]# lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0  110G  0 disk
├─sda1   8:1    0  7.5G  0 part [SWAP]
├─sda2   8:2    0 92.6G  0 part /
└─sda3   8:3    0    1G  0 part /boot
sdb      8:16   0    1G  0 disk
sdc      8:32   0    5G  0 disk
sr0     11:0    1  4.3G  0 rom
[root@testos1:/root]# lsblk -no PKNAME "$(findmnt -n -o SOURCE /boot)"
sda
```

/boot分区设置

```shell
#1、关机扩系统磁盘

#2、创建新分区
fdisk /dev/sda
mkfs.ext3 /dev/sda3

#3、迁移数据到新分区
mount /dev/sda3 /mnt
cp -ar /boot/* /mnt
echo "/dev/sda3 /boot ext3 defaults 0 0" >> /etc/fstab
mount -a
umount /mnt

#4、刷新引导文件
grub2-install /dev/sda
grub2-mkconfig -o /boot/grub2/grub.cfg

#5、重启主机检查
reboot -f
lsblk
```



